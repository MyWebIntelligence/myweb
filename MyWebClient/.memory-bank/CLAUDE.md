# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Executive Summary

**MyWebClient** is a full-stack web application built with React (frontend) and Node.js (backend API) that interfaces with a SQLite database generated by the MyWebIntelligencePython project. Its primary objective is to provide an intuitive graphical interface for cleaning, organizing, and analyzing information.

## Quick Start for Development

Before starting any work, ensure you understand the project structure by reviewing:
- `README.md` - Complete project documentation
- `.memory-bank/AGENT.md` - Application architecture mapping
- `.memory-bank/PIPELINES.md` - Functional pipelines and workflows

### Key Technical Entry Points

#### Frontend (client/src)
- **`client/src/index.js`** - React application entry point
- **`client/src/app/Context.js`** - Global configuration context and shared utilities
- **`client/src/components/App/App.js`** - Root component managing global state and authentication
- **`client/src/components/ExpressionExplorer/`** - Components for expression display and editing
- **`client/src/components/TagExplorer/`** - Components for tag management and exploration
- **`client/src/components/LandExplorer/`** - Components for "lands" exploration and filtering

#### Backend (server/src)
- **`server/src/start.js`** - Node.js server entry point
- **`server/src/authRoutes.js`** - Authentication routes (login, password reset)
- **`server/src/AdminDB.js`** - Administration database operations (users, logs, tokens)
- **`server/src/DataQueries.js`** - SQL functions for business data interactions (expressions, tags, etc.)
- **`server/src/initAdmin.js`** - Admin account initialization script

## Development Commands

### Install Dependencies
```bash
yarn install
```
This installs both server and client dependencies (via postinstall script).

### Development Mode
```bash
yarn standalone
```
Starts both the backend server and React client concurrently:
- Server: Node.js Express API on port 5001 
- Client: React development server on port 3000

### Individual Components
```bash
yarn server  # Start backend server only
yarn client  # Start React client only
```

### Client-specific Commands (in client/ directory)
```bash
cd client
yarn start   # Development server
yarn build   # Production build
yarn test    # Run tests
```

## Development Context

### Technologies & Standards
- **Frontend**: ReactJS with functional components and hooks
- **Backend**: Node.js with Express framework
- **Database**: SQLite
- **Package Manager**: Yarn
- **Containerization**: Docker
- **Code Conventions**: React/JavaScript and Node.js standards
- **Architecture Pattern**: Clear separation between frontend and backend (RESTful API), React Context for global state management

### Common Development Actions

#### Adding New Features
1. **Identify scope**: Determine if the feature is client-side, server-side, or both
2. **Client-side changes**: 
   - Create new React components
   - Update Context if needed
   - Define new API routes if required
3. **Server-side changes**:
   - Add new routes in `authRoutes.js`
   - Add query functions in `DataQueries.js`
   - Update `AdminDB.js` for admin-related features

#### Debugging
- **Client-side**: Use browser developer tools
- **Server-side**: Check terminal logs where server is running (`docker logs mwiclient` for Docker)
- **API calls**: Verify API calls and responses using network tab

#### Logging
- Server logs are displayed in console
- Access logs are managed by `AdminDB.js`

### Quick References
- **Docker Commands**:
  - `docker ps` - List running containers
  - `docker stop mwiclient` - Stop container
  - `docker start mwiclient` - Restart container
  - `docker logs mwiclient` - View container logs
  - `docker exec mwiclient cat /app/admin_password.txt` - Get Docker admin password
- **Database**: `mwi.db` expected in mounted volume `/data` inside Docker container

## Application Architecture

### Overall Structure
MyWebClient is a full-stack web application for working with MyWebIntelligence data, consisting of:
- **Backend**: FastAPI server providing a REST API for data access and authentication.
- **Frontend**: React SPA with routing, context-based state management, and component-based UI

### Backend (server/)
- **Entry Point**: `server/src/start.js` - Express server with middleware setup, routing, and static file serving
- **Database Layer**: `server/src/DataQueries.js` - SQLite database interactions for lands, expressions, tags, etc.
- **Authentication**: `server/src/authRoutes.js` - JWT-based auth with login, registration, password reset
- **Admin Init**: `server/src/initAdmin.js` - Creates initial admin account with generated password
- **Database**: SQLite database expected at `/data/mwi.db` (or configurable path)

The server serves both the API endpoints (`/api/*`) and static React files, with React Router handling client-side routing.

### Frontend (client/)
- **Main App**: `client/src/components/App/App.js` - Root component with authentication state and routing
- **Core Components**:
  - `LandExplorer`: Sidebar for browsing data collections ("lands")
  - `ExpressionExplorer`: Main content area for viewing/editing expressions
  - `TagExplorer`: Tag management and content organization
  - `DatabaseLocator`: Header component for database connection status
- **State Management**: Context API (`client/src/app/Context.js`) for global state
- **Authentication**: JWT token stored in localStorage, validated on app load

### Key Concepts
- **Lands**: Top-level data collections/projects
- **Expressions**: Individual data items within lands (web content, documents, etc.)
- **Tags**: Hierarchical organization system for content
- **Domains**: Website/source categorization

## Docker Configuration

### Development
```bash
docker build -t mwiclient:1.0 .
docker run -p 80:3000 -p 5001:5001 --name mwiclient -v /path/to/data:/data mwiclient:1.0
```

### Production
Uses `Dockerfile.prod` and `docker-compose.prod.yml`:
```bash
docker-compose -f docker-compose.prod.yml up
```

### Environment Variables
- `ADMIN_PASSWORD`: Set custom admin password (first run only)
- `RESEND_API_KEY`: For email functionality (password reset)
- `NODE_ENV`: production/development mode
- `PORT`: Server port (default 5001)

## Database Requirements

The application requires a SQLite database file (`mwi.db`) created by the MyWebIntelligencePython project. The database contains:
- Lands (data collections)
- Expressions (content items)
- Domains (websites/sources)
- Tags (hierarchical organization)
- User authentication tables

## Authentication System

- JWT-based authentication with token stored in localStorage
- Initial admin account created automatically with generated password (saved to `admin_password.txt`)
- Password reset functionality via email (requires RESEND_API_KEY)
- User management through admin interface

## Implémentation de la Consolidation et de l'Export

### Consolidation

- **Objectif**: Recalculer la pertinence, les liens et les médias pour un land donné à partir du contenu déjà crawlé.
- **Endpoint**: `POST /api/v1/lands/{land_id}/consolidate`
- **Logique**: 
    - Ajout d'une méthode `consolidate_land` au `CrawlerEngine`.
    - Création d'une tâche Celery `consolidate_land_task` pour exécuter la consolidation en arrière-plan.
    - Le service `CrawlingService` orchestre l'appel à la tâche.

### Export

- **Objectif**: Exporter les données d'un land dans différents formats (CSV, GEXF, etc.).
- **Endpoint**: `POST /api/v1/export/`
- **Logique**:
    - Création d'un `ExportService` pour gérer la logique d'exportation.
    - Création d'une tâche Celery `export_land_task` pour générer les fichiers d'export en arrière-plan.
    - L'API retourne un `job_id` pour suivre la progression de l'export et télécharger le fichier une fois prêt.
